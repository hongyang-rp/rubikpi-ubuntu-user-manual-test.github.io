import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<a id="updateSW"></a>
# 更新软件

本节介绍如何在运行 Ubuntu、Windows 或 mac 操作系统的不同主机上，将预编译镜像下载并刷写到魔方派 3 设备上。

![](../images/diagram.png)



:::warning

使用预编译镜像更新软件会擦除设备上的所有数据并安装新的镜像。请确保在开始之前备份重要数据。

:::

## 下载软件

访问 [RUBIK Pi 3 官方网站](https://www.thundercomm.com/rubik-pi-3/en/docs/image) 进行 Ubuntu24.04 软件版本下载。

<a id="enterEDL"></a>
## 进入 EDL 模式

![](../images/image-18.png)

<Tabs>
<TabItem value="method1" label="方法 1">

1. 按住上图 12 的 EDL 按钮。

   ![](../images/image-19.png)

2. 将供电线接入到上图 10。

   ![](../images/image-20.png)

3. Type-C 数据线插入上图 5 等待 3 秒，进入 9008 模式。

   ![](../images/20250314-155547.jpg)
</TabItem>
<TabItem value="method2" label="方法 2">

1. 将供电线接入到上图 10。

   ![](../images/20250314-155550.jpg)

2. Type-C 数据线插入上图 5。

   ![](../images/20250314-155547-1.jpg)

3. 在 RUBIK Pi 3 开机后，输入如下命令，进入 9008 模式。

   ```shell
   adb shell reboot edl
   ```
</TabItem>
</Tabs>

<a id="flashQDL"></a>
## 使用 QDL 工具进行烧录

QDL 是一款烧录工具，通过 QDL 可向魔方派中烧录镜像。

[点击此处下载](https://softwarecenter.qualcomm.com/api/download/software/tools/Qualcomm_Device_Loader/All/2.3.4/Qualcomm_Device_Loader.Core.2.3.4.All-AnyCPU-qdl_2.3.4.zip)
QDL，下载完成后解压，文件内容如下所示，QDL 支持多平台多架构，可通过查看 *QDL_User_Guide.pdf* 了解 QDL 的使用方法。

![](../images/image-21.png)

<Tabs>
<TabItem value="uhost" label="Ubuntu 主机">

1. 执行下面命令安装 libusb 和 libxml2（若已经安装，可忽略该步骤）。

```shell
sudo apt-get install libxml2-dev libudev-dev libusb-1.0-0-dev
```

2. 进入 FlatBuild 包的 *ufs* 目录。
3. 根据主机架构将 *QDL_Linux_x64* 或 *QDL_Linux_ARM* 目录下的 qdl 拷贝到 *ufs* 目录。
4. 执行下面命令进行烧录。

```shell
./qdl --storage ufs prog_firehose_ddr.elf rawprogram*.xml patch*.xml
```

![](../images/image-22.png)

5. 或烧录后无法启动，可尝试进入 FlatBuild 包中的 provision 目录执行下面命令重新对 UFS 进行配置（provision）。

:::warning
* 进行 provision 后，UFS 中存储的一些信息会丢失，如 SN号、以太网MAC地址等。
* 配置前，根据主机架构将 *QDL_Linux_x64* 或 *QDL_Linux_ARM* 目录下的 qdl 拷贝到 *provision* 目录
:::

```shell
./qdl prog_firehose_ddr.elf provision_ufs_1_3.xml
```

![](../images/image-23.png)

:::note
 Provison 刷机完成之后，需要手动插拔电源线和 USB 线重启设备重新进行镜像烧录。
:::
</TabItem>
<TabItem value="whost" label="Windows 主机">

1. 安装 WinUSB 驱动（若已经安装可忽略该步骤）

   1. 卸载该设备的其他驱动程序。确保未安装 Qualcomm USB 驱动程序等驱动程序。

      * 您不应该在设备管理器的 COM 端口下看到魔方派设备，如下所示，如果您在 COM 端口下看到该设备，请右键该设备，选择删除设备。

      ![](../images/image-24.png)

      * 确保已选中“删除此设备的驱动程序软件”。

      ![](../images/image-25.png)

   2. 设备断电，重新进入烧录模式，使用以下说明/屏幕截图安装 Microsoft WinUSB。

      * 在设备管理器中右键 RUBIK Pi 的 USB 端口，选择更新驱动程序。

      ![](../images/image-26.png)

      * 在通用串行总线设备中，选择 "WinUsb Device"。

      ![](../images/image-27.png)

      * 点 “是”，完成驱动更新。

      ![](../images/image-28.png)

2. 在终端中使用以下命令根据主机架构运行 *QDL_Win_x64* 或 *QDL_Win_ARM64* 目录中的 QDL 可执行文件, 进行镜像烧录,

:::note
 程序文件名不支持通配符。命令中必须列出每个镜像文件。

 将 `<pathToQDL>` 更换为 *QDL_Win_x64* 或 *QDL_Win_ARM64* 目录的实际位置。
:::

```shell
<pathToQDL>\QDL.exe prog_firehose_ddr.elf rawprogram0.xml rawprogram1.xml rawprogram2.xml rawprogram3.xml rawprogram4.xml rawprogram5.xml rawprogram6.xml patch0.xml patch1.xml patch2.xml patch3.xml patch4.xml patch5.xml patch6.xml
```

![](../images/image-29.png)

3. 或烧录后无法启动，可尝试进入 FlatBuild 包中的 provision 目录执行下面命令重新对 UFS 进行配置（provision）。

:::warning
 进行 provision 后，UFS 中存储的一些信息会丢失，如 SN号、以太网MAC地址等。

 将 `<pathToQDL>` 更换为 *QDL_Win_ARM64* 或 *QDL_Win_x64* 目录的实际位置。

:::

```shell
<pathToQDL>\QDL.exe prog_firehose_ddr.elf provision_ufs_1_3.xml
```

![](../images/image-30.png)

:::note
 Provison 刷机完成之后，需要手动插拔电源线和 USB 线重启设备重新进行镜像烧录。
:::
</TabItem>
<TabItem value="mhost" label="macOS 主机">

1. 使用以下方式安装 homebrew (若已经安装，可忽略该步骤)。

```shell
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

2. 执行下面命令安装 libusb 和 libxml2。

```shell
brew install libusb
brew install libxml2
```

3. 进入 FlatBuild 包的 *ufs* 目录。
4. 根据主机的架构将 *QDL_Mac_x64* 或 *QDL_Mac_ARM* 目录下的内容拷贝到 *ufs* 目录。
5. 执行下面命令进行烧录。

```shell
./qdl --storage ufs prog_firehose_ddr.elf rawprogram*.xml patch*.xml
```

![](../images/image-31.png)

6. 或烧录后无法启动，可尝试进入 FlatBuild 包中的 provision 目录执行下面命令重新对 UFS 进行配置（provision）。

:::note
 进行 provision 后，UFS 中存储的一些信息会丢失，如 SN 号、以太网 MAC 地址等。

 配置前，根据主机架构将 *QDL_Mac_x64* 或 *QDL_Mac_ARM* 目录下的 qdl 拷贝到 *provision* 目录
:::

```shell
./qdl prog_firehose_ddr.elf provision_ufs_1_3.xml
```

![](../images/image-32.png)

:::note
 Provison 刷机完成之后，需要手动插拔电源线和 USB 线重启设备重新进行镜像烧录。
:::
</TabItem>
</Tabs>

## 后续步骤

1. [设置设备](3.设置设备.md)
2. [运行示例应用程序](4.运行示例应用程序.md)
